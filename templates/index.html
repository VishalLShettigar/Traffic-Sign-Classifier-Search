<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Traffic Sign Classifier & Search</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      background: url('https://wallpaperaccess.com/full/1619781.jpg') center/cover no-repeat fixed;
      color: white;
      font-family: 'Segoe UI', sans-serif;
      animation: fadeIn 1s ease-in;
      min-height: 100vh;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .title-header {
      background-color: rgba(0,0,0,0.8);
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.4);
      text-align: center;
      margin: 40px auto;
      max-width: 700px;
    }

    .title-header h1 {
      font-size: 30px;
      margin-bottom: 10px;
    }

    .title-header p {
      color: #ccc;
      font-size: 16px;
    }

    .card-section {
      max-width: 900px;
      margin: auto;
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .card {
      background-color: rgba(0,0,0,0.85);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 35px rgba(0,0,0,0.4);
    }

    .btn i {
      margin-right: 5px;
    }

    .search-result img {
      max-width: 100%;
      max-height: 150px;
      border-radius: 10px;
      transition: transform 0.3s ease;
    }

    .search-result img:hover {
      transform: scale(1.4);
      z-index: 10;
    }

    .confidence-bar {
      height: 20px;
    }

    .img-fluid.rounded {
      max-height: 200px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="title-header">
      <h1>üö¶ Traffic Sign Classifier & Search</h1>
      <p>Smart AI-powered system to identify and explore traffic signs</p>
    </div>

    <div class="card-section">
      {% if mode == 'classify' %}
      <!-- Classify Card -->
      <div class="card text-center">
        <h4 class="text-white">üß† Classify Traffic Sign</h4>
        <p class="text-white-50">Upload an image to let the model predict the traffic sign.</p>
        <form method="POST" action="/index" enctype="multipart/form-data">
          <input type="hidden" name="mode" value="classify">
          <input class="form-control mb-2 w-75 mx-auto" type="file" name="file" accept="image/*" required>
          <button class="btn btn-warning w-50 mx-auto"><i class="fas fa-brain"></i> Classify</button>
          <a href="/" class="btn btn-primary w-10 mx-auto">Back</a>
        </form>
        {% if prediction %}
        <div class="text-center mt-4">
          <h5 class="text-white">Prediction: <strong>{{ prediction }}</strong></h5>
          <div class="progress confidence-bar my-2">
            <div class="progress-bar bg-success" role="progressbar" style="width: {{ (confidence * 100) | round(2) }}%;">
              {{ (confidence * 100) | round(2) }}%
            </div>
          </div>
          <img src="{{ image_path }}" class="img-fluid rounded mt-2">
        </div>
        {% endif %}
      </div>
      {% elif mode == 'search' %}
      <!-- Search Card -->
      <div class="card text-center">
        <h4 class="text-white">üîç Search Traffic Sign</h4>
        <p class="text-white-50">Search for a traffic sign and get related information, images, and descriptions.</p>
        <form method="POST" action="/index">
          <input type="hidden" name="mode" value="search">
          <input list="signs" name="sign_name" class="form-control mb-2 w-75 mx-auto" placeholder="Search traffic sign..." required>
          <datalist id="signs">
            {% for id, name in classes.items() %}
              <option value="{{ name }}">
            {% endfor %}
          </datalist>
          <button class="btn btn-primary w-50 mx-auto"><i class="fas fa-search"></i> Search</button>
          <a href="/" class="btn btn-warning w-10 mx-auto">Back</a>
        </form>
        
        {% if search_images %}
        <div class="search-result text-center mt-3">
          <h6 class="text-info">Results for "<strong>{{ search_query }}</strong>":</h6>
          <div class="row mt-3">
            {% for img, desc in zip(search_images, search_descs) %}
              <div class="col-md-6 mb-3">
                <img src="{{ img }}" alt="Traffic Sign Image" class="img-thumbnail">
                <p class="mt-2 text-white small"><strong>{{ desc }}</strong></p>
              </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
        {% if wiki_description %}
        <div class="mt-4 text-start">
          <h6 class="text-light">üìò About this Sign:</h6>
          <p id="sign-description" class="text-white-50" data-original="{{ wiki_description }}">{{ wiki_description }}</p>

          <div class="input-group mt-3">
            <label class="input-group-text bg-dark text-white" for="language">Language</label>
            <select class="form-select" id="language" onchange="translateDescription()">
              <option value="en">English</option>
              <option value="hi">Hindi</option>
              <option value="kn">Kannada</option>
            </select>
          </div>

          <div class="mt-3 d-flex gap-2">
            <form method="POST" action="/index">
              <input type="hidden" name="mode" value="search">
              <input type="hidden" name="sign_name" value="{{ search_query }}">
              <input type="hidden" name="full_info" value="1">
              <button class="btn btn-sm btn-info"><i class="fas fa-info-circle"></i> More Info</button>
            </form>
            <button class="btn btn-sm btn-success" onclick="speakDescription()"><i class="fas fa-volume-up"></i> Speak</button>
          </div>
        </div>
        {% endif %}
      </div>
      {% endif %}
    </div>

    {% if error %}
    <div class="alert alert-danger mt-4 text-center">{{ error }}</div>
    {% endif %}
  </div>

  <script>
    function speakDescription() {
      const desc = document.getElementById('sign-description').textContent;
      const lang = document.getElementById('language').value;

      const voices = speechSynthesis.getVoices();
      const utterance = new SpeechSynthesisUtterance(desc);
      utterance.lang = lang === 'hi' ? 'hi-IN' : lang === 'kn' ? 'kn-IN' : 'en-US';
      utterance.rate = 1;

      const voice = voices.find(v => v.lang === utterance.lang);
      if (voice) utterance.voice = voice;

      speechSynthesis.speak(utterance);
    }

    async function translateDescription() {
      const descElem = document.getElementById('sign-description');
      const original = descElem.getAttribute('data-original');
      const lang = document.getElementById('language').value;

      if (lang === 'en') {
        descElem.textContent = original;
        return;
      }

      try {
        const response = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=${lang}&dt=t&q=${encodeURIComponent(original)}`);
        const data = await response.json();
        const translated = data[0].map(item => item[0]).join('');
        descElem.textContent = translated;
      } catch (err) {
        alert("Translation failed. Try again.");
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
